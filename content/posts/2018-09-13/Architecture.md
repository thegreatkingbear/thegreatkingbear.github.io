---
title: "Architecture에 대해 고민해보자"
date: "2018-09-13"
cover: "https://picsum.photos/1200/800?image=1078"
category: "dev"
author: "theGreatKingBear"
tags: 
    - web
    - tech
---

사실 기본적인 아키텍처는 짜여있는 것이나 다름없다. web frontend는 React framework를 기반으로 하고, backend는 Amazon lambda를 사용하고, 아이폰과 안드로이드 앱은 React Native를 사용할 것이기 때문이다. (그리고 이 모든 것들을 배우면서 진행해야 한다! 개꾸르..잼..)

오늘 고민해 볼 내용은 좀 더 세부적인 내용들이다. 특히 React framework를 사용하지만, 가장 중요하게는 데이터의 흐름을 어떻게 제어하고 관리할 것인지, 이를 위해 어떤 철학이나 패턴을 사용할 것이며, 그러기 위해 백엔드는 어떻게 연결할 것인지 등을 이야기해보고 싶다. 

아이폰 앱을 만들면서 가장 크게 고민이 되었던 것이 ugly fat ViewController 였다. 뷰컨트롤러에 다 때려넣다 보니 2~3천 라인이 우습게 넘어가는 뚱뚱함에 나중에는 로직 찾아보기도 어려운 못생김이 보기 싫어 이를 간결하게 할 패턴을 찾게 되었다. 

특히 앱의 완성도를 많이 해치는 부분 중의 하나가 다양한 로직 간의 속도 차이로 인해 생기는 다양한 버그들이다. 예를 들어 무언가를 서버에서 구매하고 나면, 상태가 바뀌었기 때문에 어떤 행동이 가능해지거나 어떤 것은 할 수 없는 등의 로직 변화가 생기는데, 서버와의 통신이 느리거나 UI 딜레이 등으로 뷰가 변경되었을 때 상태 업데이트가 잘 반영되지 않는 등의 문제로 버그가 생기면 짜증도 나고 잡기도 어렵다. 

사실 이 부분에서 Redux라는 개념을 처음 접하고 아이폰 앱 개발에 먼저 적용(ReSwift)을 했었다. Redux에서 내가 매력을 느꼈던 점은 세 가지 principles가 있는데, 

* Single source of truth 
* State is read-only
* Changes are made with pure functions

앱의 모든 상태를 하나의 오브젝트 트리 안에 보관하므로 말 그대로 하나의 진실! 이것저것 참조할 필요도 없고, 서로 다른 곳에 있는 데이터의 동기화 등을 고민할 필요도 없다. 또한 상태를 변경하려면 액션을 통해 새로운 상태(state)를 만드는 식으로만 가능하므로 미묘한 타이밍으로 인해 상태변경의 순서가 바뀌어서 애먹을 일이 없다. (적어도 디버그는 가능하다! 몽땅 순서대로 logging되니까) 순수함수로 된 reducer안에서 action을 만든다는 원칙도 있다. 모든 상태 변화를 예측가능하게 만들겠다는 강력한 의지가 느껴지지 않습니까? 여러분?

실제로 ReSwift를 통해 Redux을 경험하면서 걱정되었던 점도 몇 가지 있다. 우선 아무래도 코딩 양이 많이 늘어나지 않느냐는 점과 하나의 오브젝트 트리 안에 모든 것을 때려 넣으면 혹시 속도가 느려지거나 하는 골치아픔이 있지 않을까 하는 걱정도 있었다. 실제 맛을 본 경험으로 말하자면, 분명 코드 양이 늘어나는 부분이 있지만, MVVM+P 패턴을 도입한 것에 비해서는 늘어난 부분이 훨씬 적었고 (MVC -> ReSwift+MVVM+P 라는 괴랄한 패턴까지 도입했다...헉) 순수 로직 때려넣는 것으로는 별 문제없다는 결론이다. 

그래서 결론은 React에 상태관리는 Redux를 사용한다는 것이다. Mobx 등도 있지만 난 Redux가 좋으니까 (그리고 한 번 써봤으니까..) 이걸로 꽝꽝. 그럼 또 결정해야 할 것은 Navigation Library이다. 